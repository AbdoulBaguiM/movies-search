<div align="center">
<a name="readme-top"></a>

# Movies Search App

  <p align="center">
    <a href="https://github.com/AbdoulBaguiM/movies-search/issues/new">Report Bug</a>
    Â·
    <a href="https://github.com/AbdoulBaguiM/movies-search/issues/new">Request Feature</a>
  </p>
</div>

<br/>

<!-- TABLE OF CONTENTS -->
<details>
  <summary>Table of Contents</summary>
  <ol>
    <li>
      <a href="#about-the-project">About The Project</a>
      <ul>
        <li><a href="#built-with">Built With</a></li>
      </ul>
    </li>
    <li>
      <a href="#getting-started">Getting Started</a>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#installation">Installation</a></li>
      </ul>
    </li>
    <li><a href="#application">Application</a></li>
    <li><a href="#contributing">Contributing</a></li>
    <li><a href="#license">License</a></li>
  </ol>
</details>

<!-- ABOUT THE PROJECT -->

## About The Project

![Movies Search App](https://github.com/AbdoulBaguiM/movies-search/blob/master/assets/architecture.png)

It's a movie search application that indexes data from the IMDB API to a local deployment of Elasticsearch made using Docker containers, all orchestrated by a Nodejs server.

### Built With

 ![React.js] ![Tailwindcss] ![Elasticsearch] ![Node.js] ![Express.js] ![IMDb]

<p align="right">(<a href="#readme-top">back to top</a>)</p>

<!-- GETTING STARTED -->

## Getting Started

Follow these steps to get the project locally on your machine.

### Prerequisites

- Docker
- IMDb API key

### Installation

1. Get a free IMDb API Key [here](https://imdb-api.com/Identity/Account/Register)

2. Clone the repo by running: 
   ```sh
   git clone https://github.com/AbdoulBaguiM/movies-search.git
   ```
3. Edit the `.env` file by filling in your settings (specify the stack version you want to work on, the `ELASTIC_PASSWORD` and `KIBANA_PASSWORD`)

4. Next, open a terminal an run:

   ```sh
   docker-compose up -d
   ```

   It may take some time depending on your internet connection as it will pull Elasticsearch and Kibana images from the Docker Hub.

5. Once the containers are launched, take care of the backend first. Open a new terminal, `cd` into the backend folder and install the dependencies by running:

   ```sh
   yarn
   ```

6. Rename the `.env.example` file to `.env` and fill in the `ELASTICSEARCH_CLIENT` and `ELASTICSEARCH_PASSWORD` as well as the port on which the backend server will be deployed and the IMDB `API_KEY` you got on step (<a href="#installation">1</a>).

7. Next, you'll need to copy the certificates generated by the setup service when you launched `docker-compose` in the backend folder, to ensure a secure connexion between your application and Elasticsearch (this step is crucial). Run the following command in a terminal after filling in the full path to the backend folder:

   ```sh
   docker cp es01:/usr/share/elasticsearch/config/certs/ca/ca.crt YOUR/PATH/TO/BACKEND/FOLDER/certs
   ```

8. Once done, you can run the backend with:

   ```sh
   yarn run dev
   ```

9. Before indexing the data from IMDb, you need to create the `movies` index in Elasticsearch, so open [Kibana](http://localhost:5601) in your browser, log in using the password you set in step 3. Open `Dev tools > Console` and run this command to create the mapping:

  ```sh
  PUT movies
  {
      "mappings": {
      "properties": {
          "contentRating": {
              "type": "text",
              "fields": {
                  "keyword": {
                      "type": "keyword",
                      "ignore_above": 256
                  }
              }
          },
          "directors": {
              "type": "text",
              "fields": {
                  "keyword": {
                      "type": "keyword",
                      "ignore_above": 256
                  }
              }
          },
          "genres": {
              "type": "keyword"
          },
          "imDbRating": {
              "type": "float"
          },
          "imDbRatingCount": {
              "type": "integer"
          },
          "image": {
              "type": "text",
              "fields": {
                  "keyword": {
                      "type": "keyword"
                  }
              }
          },
          "plot": {
              "type": "text"
          },
          "runtimeMins": {
              "type": "integer"
          },
          "stars": {
              "type": "text",
                  "fields": {
                      "keyword": {
                          "type": "keyword"
                      }
              }
          },
          "title": {
              "type": "text",
              "fields": {
                  "keyword": {
                      "type": "keyword",
                      "ignore_above": 256
                  }
              }
          }
      }
  }
  ```

10. We'll also configure a pipeline to ingest our data before indexing so, run the following:

  ```sh
  PUT _ingest/pipeline/movies_pipeline
  {
    "processors": [
          {
              "remove": {
                  "field": [
                      "id",
                      "title",
                      "year",
                      "releaseState",
                      "metacriticRating",
                      "genreList",
                      "directorList",
                      "starList",
                      "runtimeStr"
                  ],
                  "ignore_missing": true
              }
          },
          {
              "rename": {
                  "field": "fullTitle",
                  "target_field": "title"
              }
          },
          {
              "trim": {
                  "field": "genres",
                  "ignore_missing": true
              }
          },
          {
              "split": {
                  "field": "genres",
                  "separator": ",",
                  "ignore_missing": true
              }
          }
      ]
  }
  ```

11. Now that every thing is setup, open a new tab in your browser an go to http://localhost:3001/ingest_movies. The data will be collected from IMDb, it will be transformed through the newly created pipeline before being added to our index created in step (9).

12. You can now open a new terminal in the frontend browser and install the dependeciesby running:

  ```
  yarn
  ```

13. The application will be available at : http://localhost:3000

## Application

  ![demo](https://github.com/AbdoulBaguiM/movies-search/blob/master/assets/demo.gif)

<p align="right">(<a href="#readme-top">back to top</a>)</p>

<!-- CONTRIBUTING -->

## Contributing

If you have a suggestion that would make this better, please fork the repo and create a pull request. You can also simply open an issue with the tag "enhancement".
Don't forget to give the project a star! Thanks again!

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

![license-shield]

<p align="right">(<a href="#readme-top">back to top</a>)</p>

[React.js]: https://img.shields.io/badge/React-20232A?style=for-the-badge&logo=react&logoColor=61DAFB
[Node.js]: https://img.shields.io/badge/NodeJS-35495E?style=for-the-badge&logo=nodedotjs&logoColor=4FC08D
[Tailwindcss]: https://img.shields.io/badge/TAIWINDCSS-0769AD?style=for-the-badge&logo=tailwindcss&logoColor=white
[Elasticsearch]: https://img.shields.io/badge/Elasticsearch-FCC690?style=for-the-badge&logo=elasticsearch&logoColor=white
[Express.js]: https://img.shields.io/badge/Express-FFF?style=for-the-badge&logo=express&logoColor=black
[IMDb]: https://img.shields.io/badge/IMDB-000000?style=for-the-badge&logo=imdb&logoColor=yellow
[license-shield]: https://img.shields.io/github/license/othneildrew/Best-README-Template.svg?style=for-the-badge
